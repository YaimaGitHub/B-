import jsPDF from 'jspdf';
import html2canvas from 'html2canvas';
import { toastHandler } from './utils';
import { ToastType } from '../constants/constants';

/**
 * Generador de gu√≠a PDF completa de la tienda Yero Shop!
 * Crea un tour guiado paso a paso con capturas de pantalla en tiempo real
 */

export class PDFGuideGenerator {
  constructor() {
    this.pdf = null;
    this.currentPage = 1;
    this.pageHeight = 297; // A4 height in mm
    this.pageWidth = 210; // A4 width in mm
    this.margin = 20;
    this.lineHeight = 7;
    this.currentY = this.margin;
  }

  /**
   * Inicializa el documento PDF
   */
  initializePDF() {
    this.pdf = new jsPDF('p', 'mm', 'a4');
    this.currentY = this.margin;
    
    // Configurar fuentes
    this.pdf.setFont('helvetica');
  }

  /**
   * Agrega una nueva p√°gina si es necesario
   */
  checkPageBreak(requiredHeight = 20) {
    if (this.currentY + requiredHeight > this.pageHeight - this.margin) {
      this.pdf.addPage();
      this.currentPage++;
      this.currentY = this.margin;
      return true;
    }
    return false;
  }

  /**
   * Agrega texto con formato
   */
  addText(text, fontSize = 12, style = 'normal', color = [0, 0, 0]) {
    this.pdf.setFontSize(fontSize);
    this.pdf.setTextColor(...color);
    
    if (style === 'bold') {
      this.pdf.setFont('helvetica', 'bold');
    } else {
      this.pdf.setFont('helvetica', 'normal');
    }

    // Dividir texto en l√≠neas que quepan en la p√°gina
    const maxWidth = this.pageWidth - (this.margin * 2);
    const lines = this.pdf.splitTextToSize(text, maxWidth);
    
    lines.forEach(line => {
      this.checkPageBreak();
      this.pdf.text(line, this.margin, this.currentY);
      this.currentY += this.lineHeight;
    });
  }

  /**
   * Agrega un t√≠tulo con formato especial
   */
  addTitle(title, level = 1) {
    this.checkPageBreak(15);
    
    const fontSize = level === 1 ? 18 : level === 2 ? 16 : 14;
    const color = level === 1 ? [30, 64, 175] : [59, 130, 246]; // Azul primario
    
    this.currentY += 5; // Espacio antes del t√≠tulo
    this.addText(title, fontSize, 'bold', color);
    this.currentY += 3; // Espacio despu√©s del t√≠tulo
  }

  /**
   * Agrega una l√≠nea separadora
   */
  addSeparator() {
    this.checkPageBreak(5);
    this.pdf.setDrawColor(200, 200, 200);
    this.pdf.line(this.margin, this.currentY, this.pageWidth - this.margin, this.currentY);
    this.currentY += 5;
  }

  /**
   * Captura screenshot de un elemento espec√≠fico
   */
  async captureElement(selector, description) {
    try {
      const element = document.querySelector(selector);
      if (!element) {
        console.warn(`Elemento ${selector} no encontrado`);
        return null;
      }

      const canvas = await html2canvas(element, {
        scale: 1,
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#ffffff'
      });

      return {
        canvas,
        description,
        width: canvas.width,
        height: canvas.height
      };
    } catch (error) {
      console.error('Error capturando elemento:', error);
      return null;
    }
  }

  /**
   * Agrega una imagen al PDF
   */
  addImage(canvas, description, maxWidth = 160) {
    if (!canvas) return;

    const imgWidth = maxWidth;
    const imgHeight = (canvas.height * maxWidth) / canvas.width;
    
    this.checkPageBreak(imgHeight + 15);
    
    // Agregar descripci√≥n
    if (description) {
      this.addText(description, 10, 'bold', [100, 100, 100]);
      this.currentY += 2;
    }

    // Agregar imagen
    const imgData = canvas.toDataURL('image/jpeg', 0.8);
    this.pdf.addImage(imgData, 'JPEG', this.margin, this.currentY, imgWidth, imgHeight);
    this.currentY += imgHeight + 10;
  }

  /**
   * Agrega la portada del documento
   */
  addCover() {
    // Logo y t√≠tulo principal
    this.pdf.setFontSize(28);
    this.pdf.setTextColor(30, 64, 175);
    this.pdf.setFont('helvetica', 'bold');
    this.pdf.text('Yero Shop!', this.pageWidth / 2, 50, { align: 'center' });
    
    this.pdf.setFontSize(20);
    this.pdf.setTextColor(100, 100, 100);
    this.pdf.text('Gu√≠a Completa de Usuario', this.pageWidth / 2, 65, { align: 'center' });
    
    this.pdf.setFontSize(14);
    this.pdf.text('Tour Guiado Paso a Paso', this.pageWidth / 2, 75, { align: 'center' });

    // Informaci√≥n de la tienda
    this.currentY = 100;
    this.addText('üè™ La plataforma de comercio detr√°s de todo', 16, 'bold', [59, 130, 246]);
    this.currentY += 5;
    
    this.addText('üìç Santiago de Cuba, Cuba', 12);
    this.addText('üì± WhatsApp: +53 54690878', 12);
    this.addText('üåê yeroshop.vercel.app', 12);
    
    this.currentY += 20;
    this.addSeparator();
    
    // Tabla de contenidos
    this.addTitle('üìã Contenido de la Gu√≠a', 2);
    
    const contents = [
      '1. Introducci√≥n a Yero Shop!',
      '2. Navegaci√≥n Principal',
      '3. Explorar Productos y Categor√≠as',
      '4. B√∫squeda Avanzada',
      '5. Gesti√≥n de Carrito de Compras',
      '6. Lista de Deseos',
      '7. Registro e Inicio de Sesi√≥n',
      '8. Gesti√≥n de Direcciones',
      '9. Proceso de Checkout',
      '10. Configuraci√≥n de Monedas',
      '11. Pedidos por WhatsApp',
      '12. Panel de Administraci√≥n',
      '13. Consejos y Trucos',
      '14. Preguntas Frecuentes'
    ];

    contents.forEach(item => {
      this.addText(item, 11);
    });

    // Fecha de generaci√≥n
    this.currentY = this.pageHeight - 40;
    this.addText(`üìÖ Gu√≠a generada el: ${new Date().toLocaleDateString('es-CU', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    })}`, 10, 'normal', [150, 150, 150]);
  }

  /**
   * Agrega secci√≥n de introducci√≥n
   */
  addIntroduction() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üéØ 1. Introducci√≥n a Yero Shop!');
    
    this.addText('¬°Bienvenido a Yero Shop!, tu tienda online de confianza en Santiago de Cuba! Esta gu√≠a te ayudar√° a aprovechar al m√°ximo todas las funcionalidades de nuestra plataforma de comercio electr√≥nico.', 12);
    
    this.addTitle('‚ú® Caracter√≠sticas Principales:', 2);
    
    const features = [
      'üõçÔ∏è Cat√°logo completo de productos electr√≥nicos',
      'üîç B√∫squeda inteligente con sugerencias',
      'üõí Carrito de compras avanzado',
      '‚ù§Ô∏è Lista de deseos personalizada',
      'üìç Gesti√≥n de direcciones de entrega',
      'üí± M√∫ltiples monedas (CUP, USD, EUR, MLC)',
      'üé´ Sistema de cupones de descuento',
      'üì± Pedidos directos por WhatsApp',
      'üöö Entrega a domicilio y recogida en tienda',
      'üëë Panel de administraci√≥n completo'
    ];

    features.forEach(feature => {
      this.addText(feature, 11);
    });

    this.addSeparator();
    
    this.addTitle('üéØ Objetivo de esta Gu√≠a:', 2);
    this.addText('Esta gu√≠a te llevar√° paso a paso por todas las funcionalidades de Yero Shop!, desde la navegaci√≥n b√°sica hasta funciones avanzadas como la gesti√≥n de pedidos y configuraci√≥n de monedas.', 12);
  }

  /**
   * Agrega secci√≥n de navegaci√≥n
   */
  addNavigationSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üß≠ 2. Navegaci√≥n Principal');
    
    this.addText('La barra de navegaci√≥n de Yero Shop! est√° dise√±ada para ser intuitiva y accesible desde cualquier dispositivo.', 12);
    
    this.addTitle('üîù Barra Superior:', 2);
    
    const navElements = [
      'üè† Logo "Yero Shop!" - Lleva al inicio',
      'üîç Barra de b√∫squeda - Busca productos espec√≠ficos',
      'üì± "Explorar" - Ve al cat√°logo completo',
      'üë§ Perfil/Login - Gestiona tu cuenta',
      '‚ù§Ô∏è Lista de deseos - Productos guardados',
      'üõí Carrito - Productos para comprar'
    ];

    navElements.forEach(element => {
      this.addText(element, 11);
    });

    this.addTitle('üì± Navegaci√≥n M√≥vil:', 2);
    this.addText('En dispositivos m√≥viles, la navegaci√≥n se adapta autom√°ticamente para una mejor experiencia t√°ctil. Los iconos se reorganizan para facilitar el acceso con una sola mano.', 12);
  }

  /**
   * Agrega secci√≥n de productos
   */
  addProductsSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üì¶ 3. Explorar Productos y Categor√≠as');
    
    this.addTitle('üè† P√°gina de Inicio:', 2);
    this.addText('La p√°gina principal muestra:', 12);
    
    const homeFeatures = [
      'üéØ Banner principal con mensaje de bienvenida',
      'üìÇ Categor√≠as principales con im√°genes atractivas',
      '‚≠ê Productos destacados seleccionados',
      'üîó Enlaces r√°pidos a secciones importantes'
    ];

    homeFeatures.forEach(feature => {
      this.addText(feature, 11);
    });

    this.addTitle('üìÇ Sistema de Categor√≠as:', 2);
    this.addText('Las categor√≠as est√°n organizadas visualmente con im√°genes representativas. Al hacer clic en una categor√≠a, se filtran autom√°ticamente los productos relacionados.', 12);

    this.addTitle('üõçÔ∏è P√°gina de Productos:', 2);
    this.addText('La p√°gina de productos incluye:', 12);
    
    const productFeatures = [
      'üéõÔ∏è Filtros avanzados (precio, marca, categor√≠a, calificaci√≥n)',
      'üìä Ordenamiento (precio, nombre, popularidad)',
      'üìÑ Paginaci√≥n inteligente',
      'üîç B√∫squeda en tiempo real',
      'üì± Dise√±o responsivo para todos los dispositivos'
    ];

    productFeatures.forEach(feature => {
      this.addText(feature, 11);
    });
  }

  /**
   * Agrega secci√≥n de b√∫squeda
   */
  addSearchSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üîç 4. B√∫squeda Avanzada');
    
    this.addText('El sistema de b√∫squeda de Yero Shop! utiliza tecnolog√≠a avanzada para encontrar exactamente lo que necesitas.', 12);
    
    this.addTitle('üöÄ Caracter√≠sticas de la B√∫squeda:', 2);
    
    const searchFeatures = [
      '‚ö° Sugerencias en tiempo real mientras escribes',
      'üß† B√∫squeda inteligente con correcci√≥n autom√°tica',
      'üíæ Cach√© de b√∫squedas para mayor velocidad',
      'üéØ Filtrado autom√°tico por nombre de producto',
      'üì± Optimizada para dispositivos m√≥viles'
    ];

    searchFeatures.forEach(feature => {
      this.addText(feature, 11);
    });

    this.addTitle('üìù C√≥mo Usar la B√∫squeda:', 2);
    
    const searchSteps = [
      '1. üìù Escribe el nombre del producto en la barra de b√∫squeda',
      '2. üëÄ Observa las sugerencias que aparecen autom√°ticamente',
      '3. üñ±Ô∏è Haz clic en una sugerencia o presiona Enter',
      '4. üìã Los resultados se mostrar√°n filtrados autom√°ticamente',
      '5. üéõÔ∏è Usa los filtros adicionales para refinar tu b√∫squeda'
    ];

    searchSteps.forEach(step => {
      this.addText(step, 11);
    });
  }

  /**
   * Agrega secci√≥n del carrito
   */
  addCartSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üõí 5. Gesti√≥n de Carrito de Compras');
    
    this.addText('El carrito de Yero Shop! est√° dise√±ado para una experiencia de compra fluida y segura.', 12);
    
    this.addTitle('‚ûï Agregar Productos:', 2);
    
    const addSteps = [
      '1. üé® Selecciona el color deseado del producto',
      '2. üõí Haz clic en "Agregar al Carrito"',
      '3. ‚úÖ Confirma que el producto se agreg√≥ (aparece notificaci√≥n)',
      '4. üî¢ El contador del carrito se actualiza autom√°ticamente'
    ];

    addSteps.forEach(step => {
      this.addText(step, 11);
    });

    this.addTitle('‚öôÔ∏è Gesti√≥n en el Carrito:', 2);
    
    const cartFeatures = [
      'üìä Resumen detallado de precios',
      'üî¢ Modificar cantidades de productos',
      'üé® Ver colores seleccionados',
      'üóëÔ∏è Eliminar productos individuales',
      'üßπ Limpiar carrito completo',
      '‚ù§Ô∏è Mover productos a lista de deseos',
      'üí∞ C√°lculo autom√°tico de totales'
    ];

    cartFeatures.forEach(feature => {
      this.addText(feature, 11);
    });

    this.addTitle('üí° Consejos del Carrito:', 2);
    this.addText('‚Ä¢ El carrito se sincroniza autom√°ticamente con tu cuenta', 11);
    this.addText('‚Ä¢ Los productos se reservan temporalmente mientras est√°n en tu carrito', 11);
    this.addText('‚Ä¢ Puedes modificar cantidades directamente desde el carrito', 11);
    this.addText('‚Ä¢ El sistema verifica autom√°ticamente la disponibilidad de stock', 11);
  }

  /**
   * Agrega secci√≥n de lista de deseos
   */
  addWishlistSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('‚ù§Ô∏è 6. Lista de Deseos');
    
    this.addText('La lista de deseos te permite guardar productos para comprar m√°s tarde.', 12);
    
    this.addTitle('üíù Funcionalidades:', 2);
    
    const wishlistFeatures = [
      '‚ù§Ô∏è Guardar productos favoritos',
      'üõí Mover directamente al carrito',
      'üëÄ Seguimiento de productos de inter√©s',
      'üîÑ Sincronizaci√≥n con tu cuenta',
      'üì± Acceso desde cualquier dispositivo',
      'üßπ Gesti√≥n completa de la lista'
    ];

    wishlistFeatures.forEach(feature => {
      this.addText(feature, 11);
    });

    this.addTitle('üìù C√≥mo Usar la Lista de Deseos:', 2);
    
    const wishlistSteps = [
      '1. ‚ù§Ô∏è Haz clic en el coraz√≥n de cualquier producto',
      '2. ‚úÖ El producto se agrega autom√°ticamente',
      '3. üìã Ve a tu lista de deseos desde el men√∫',
      '4. üõí Mueve productos al carrito cuando quieras comprar',
      '5. üóëÔ∏è Elimina productos que ya no te interesen'
    ];

    wishlistSteps.forEach(step => {
      this.addText(step, 11);
    });
  }

  /**
   * Agrega secci√≥n de autenticaci√≥n
   */
  addAuthSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üîê 7. Registro e Inicio de Sesi√≥n');
    
    this.addTitle('üìù Crear Nueva Cuenta:', 2);
    
    const signupSteps = [
      '1. üñ±Ô∏è Haz clic en "Iniciar Sesi√≥n" en la navegaci√≥n',
      '2. üìù Selecciona "reg√≠strate aqu√≠"',
      '3. ‚úçÔ∏è Completa el formulario con tus datos',
      '4. üìß Usa un email v√°lido (Gmail, Yahoo, Hotmail, etc.)',
      '5. üîí Crea una contrase√±a segura (m√≠nimo 6 caracteres)',
      '6. ‚úÖ Confirma tu contrase√±a',
      '7. üéâ ¬°Listo! Ya puedes usar todas las funciones'
    ];

    signupSteps.forEach(step => {
      this.addText(step, 11);
    });

    this.addTitle('üö™ Iniciar Sesi√≥n:', 2);
    
    const loginOptions = [
      'üë§ Cuenta personal - Usa tu email y contrase√±a',
      'üë• Cuenta de invitado - Acceso r√°pido para probar',
      'üëë Acceso administrador - Solo para personal autorizado'
    ];

    loginOptions.forEach(option => {
      this.addText(option, 11);
    });

    this.addTitle('üîí Seguridad:', 2);
    this.addText('‚Ä¢ Todas las contrase√±as est√°n encriptadas', 11);
    this.addText('‚Ä¢ Tu informaci√≥n personal est√° protegida', 11);
    this.addText('‚Ä¢ Sesiones seguras con tokens JWT', 11);
    this.addText('‚Ä¢ Puedes cerrar sesi√≥n desde cualquier dispositivo', 11);
  }

  /**
   * Agrega secci√≥n de direcciones
   */
  addAddressSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üìç 8. Gesti√≥n de Direcciones');
    
    this.addText('Yero Shop! ofrece dos tipos de servicio para recibir tus productos.', 12);
    
    this.addTitle('üöö Entrega a Domicilio:', 2);
    
    const deliverySteps = [
      '1. üìç Selecciona tu zona en Santiago de Cuba',
      '2. üè† Ingresa tu direcci√≥n completa',
      '3. üë§ Especifica qui√©n recibir√° el pedido',
      '4. üìû Proporciona n√∫mero de contacto del receptor',
      '5. üí∞ El costo de entrega se calcula autom√°ticamente'
    ];

    deliverySteps.forEach(step => {
      this.addText(step, 11);
    });

    this.addTitle('üè™ Recogida en Tienda:', 2);
    
    const pickupSteps = [
      '1. üìç Selecciona "Recoger en local"',
      '2. üó∫Ô∏è Ve la ubicaci√≥n exacta de la tienda',
      '3. üì± Calcula la distancia desde tu ubicaci√≥n',
      '4. üïí Coordina el horario de recogida',
      '5. üí∞ Sin costo adicional de entrega'
    ];

    pickupSteps.forEach(step => {
      this.addText(step, 11);
    });

    this.addTitle('üìã Zonas de Entrega Disponibles:', 2);
    
    const zones = [
      'Vista Alegre - $300 CUP',
      'Sue√±o - $250 CUP',
      'San Pedrito - $150 CUP',
      'Altamira - $500 CUP',
      'Micro 7, 8, 9 - $150 CUP',
      'Y muchas m√°s...'
    ];

    zones.forEach(zone => {
      this.addText(zone, 11);
    });
  }

  /**
   * Agrega secci√≥n de checkout
   */
  addCheckoutSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üí≥ 9. Proceso de Checkout');
    
    this.addText('El proceso de finalizaci√≥n de compra en Yero Shop! es simple y seguro.', 12);
    
    this.addTitle('üìã Pasos del Checkout:', 2);
    
    const checkoutSteps = [
      '1. üõí Revisa los productos en tu carrito',
      '2. üìç Selecciona o agrega una direcci√≥n de entrega',
      '3. üé´ Aplica cupones de descuento si tienes',
      '4. üí∞ Revisa el resumen de precios',
      '5. üì± Confirma tu pedido por WhatsApp',
      '6. ‚úÖ Recibe confirmaci√≥n del pedido'
    ];

    checkoutSteps.forEach(step => {
      this.addText(step, 11);
    });

    this.addTitle('üé´ Sistema de Cupones:', 2);
    
    const couponInfo = [
      'üîç Busca cupones disponibles en el checkout',
      'üí∞ Los descuentos se aplican autom√°ticamente',
      'üìä Ve el ahorro en tiempo real',
      '‚ö†Ô∏è Los cupones tienen requisitos m√≠nimos de compra',
      'üéØ Solo se aplican si todos los productos los permiten'
    ];

    couponInfo.forEach(info => {
      this.addText(info, 11);
    });

    this.addTitle('üì± Pedido por WhatsApp:', 2);
    this.addText('Yero Shop! utiliza WhatsApp para procesar pedidos de forma personal y directa:', 12);
    
    const whatsappFeatures = [
      'üìã Resumen completo del pedido',
      'üë§ Informaci√≥n del cliente',
      'üìç Detalles de entrega',
      'üí∞ Desglose de precios',
      'üó∫Ô∏è Enlaces de ubicaci√≥n si es recogida',
      'üìû Contacto directo con la tienda'
    ];

    whatsappFeatures.forEach(feature => {
      this.addText(feature, 11);
    });
  }

  /**
   * Agrega secci√≥n de monedas
   */
  addCurrencySection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üí± 10. Configuraci√≥n de Monedas');
    
    this.addText('Yero Shop! soporta m√∫ltiples monedas para tu comodidad.', 12);
    
    this.addTitle('üí∞ Monedas Disponibles:', 2);
    
    const currencies = [
      'üá®üá∫ CUP (Peso Cubano) - Moneda base',
      'üá∫üá∏ USD (D√≥lar Estadounidense) - Tasa del mercado',
      'üá™üá∫ EUR (Euro) - Tasa del mercado',
      'üè¶ MLC (Moneda Libremente Convertible) - Moneda digital'
    ];

    currencies.forEach(currency => {
      this.addText(currency, 11);
    });

    this.addTitle('üîÑ Cambiar Moneda:', 2);
    
    const currencySteps = [
      '1. üë§ Ve a tu perfil',
      '2. üí± Selecciona "Monedas"',
      '3. üéØ Elige la moneda deseada',
      '4. ‚úÖ Los precios se actualizan autom√°ticamente',
      '5. üíæ Tu preferencia se guarda para futuras visitas'
    ];

    currencySteps.forEach(step => {
      this.addText(step, 11);
    });

    this.addTitle('üìä Conversi√≥n Autom√°tica:', 2);
    this.addText('Todos los precios se convierten autom√°ticamente seg√∫n las tasas de cambio actuales del mercado cubano. La conversi√≥n es transparente y se muestra en tiempo real.', 12);
  }

  /**
   * Agrega secci√≥n del panel de administraci√≥n
   */
  addAdminSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üëë 11. Panel de Administraci√≥n');
    
    this.addText('El panel de administraci√≥n permite gestionar completamente la tienda (solo para administradores).', 12);
    
    this.addTitle('üõ†Ô∏è Funcionalidades del Admin:', 2);
    
    const adminFeatures = [
      'üì¶ Gesti√≥n completa de productos',
      'üìÇ Administraci√≥n de categor√≠as',
      'üé´ Control de cupones de descuento',
      'üìç Configuraci√≥n de zonas de entrega',
      'üí¨ Gesti√≥n de mensajes de la tienda',
      'üí± Configuraci√≥n de tasas de cambio',
      'üíæ Sistema de backup completo',
      'üìä Estad√≠sticas en tiempo real'
    ];

    adminFeatures.forEach(feature => {
      this.addText(feature, 11);
    });

    this.addTitle('üîê Acceso de Administrador:', 2);
    this.addText('Para acceder al panel de administraci√≥n:', 12);
    
    const adminSteps = [
      '1. üö™ Ve a la p√°gina de login',
      '2. üëë Haz clic en "Acceso Administrador"',
      '3. üîë Ingresa las credenciales de administrador',
      '4. ‚úÖ Accede al panel de control completo'
    ];

    adminSteps.forEach(step => {
      this.addText(step, 11);
    });
  }

  /**
   * Agrega consejos y trucos
   */
  addTipsSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üí° 12. Consejos y Trucos');
    
    this.addTitle('üöÄ Optimiza tu Experiencia:', 2);
    
    const tips = [
      'üì± Usa la app en modo pantalla completa para mejor experiencia',
      'üîç Aprovecha las sugerencias de b√∫squeda para encontrar productos r√°pido',
      '‚ù§Ô∏è Guarda productos en lista de deseos para comprar despu√©s',
      'üé´ Revisa cupones disponibles antes de finalizar compra',
      'üìç Calcula distancia a la tienda si vas a recoger',
      'üí± Cambia de moneda seg√∫n tu preferencia',
      'üîî Mant√©n las notificaciones activadas para ofertas',
      'üì± Usa WhatsApp para comunicaci√≥n directa con la tienda'
    ];

    tips.forEach(tip => {
      this.addText(tip, 11);
    });

    this.addTitle('‚ö° Funciones Avanzadas:', 2);
    
    const advancedTips = [
      'üéõÔ∏è Combina m√∫ltiples filtros para b√∫squedas precisas',
      'üìä Ordena productos por precio o popularidad',
      'üé® Compara colores disponibles antes de elegir',
      'üì¶ Verifica disponibilidad de env√≠o por producto',
      'üí∞ Usa el calculador de distancia para planificar recogida',
      'üîÑ Sincroniza tu carrito entre dispositivos'
    ];

    advancedTips.forEach(tip => {
      this.addText(tip, 11);
    });
  }

  /**
   * Agrega preguntas frecuentes
   */
  addFAQSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('‚ùì 13. Preguntas Frecuentes');
    
    const faqs = [
      {
        q: 'üõí ¬øC√≥mo puedo modificar mi carrito?',
        a: 'Puedes cambiar cantidades, eliminar productos o mover a lista de deseos directamente desde la p√°gina del carrito.'
      },
      {
        q: 'üì± ¬øC√≥mo funciona el pedido por WhatsApp?',
        a: 'Al finalizar compra, se genera autom√°ticamente un mensaje con todos los detalles que se env√≠a a nuestro WhatsApp oficial.'
      },
      {
        q: 'üí± ¬øPuedo cambiar la moneda de los precios?',
        a: 'S√≠, ve a Perfil > Monedas y selecciona entre CUP, USD, EUR o MLC. Los precios se actualizan autom√°ticamente.'
      },
      {
        q: 'üöö ¬øCu√°nto cuesta la entrega?',
        a: 'El costo var√≠a seg√∫n la zona en Santiago de Cuba. Se calcula autom√°ticamente al seleccionar tu direcci√≥n.'
      },
      {
        q: 'üé´ ¬øC√≥mo uso los cupones de descuento?',
        a: 'En el checkout, ingresa el c√≥digo del cup√≥n. Solo se aplica si todos los productos del carrito lo permiten.'
      },
      {
        q: 'üìç ¬øPuedo recoger en la tienda?',
        a: 'S√≠, selecciona "Recoger en local" al agregar direcci√≥n. Incluye mapa y calculadora de distancia.'
      }
    ];

    faqs.forEach(faq => {
      this.addTitle(faq.q, 3);
      this.addText(faq.a, 11);
      this.currentY += 3;
    });
  }

  /**
   * Agrega informaci√≥n de contacto
   */
  addContactSection() {
    this.pdf.addPage();
    this.currentPage++;
    this.currentY = this.margin;

    this.addTitle('üìû 14. Informaci√≥n de Contacto');
    
    this.addText('¬øNecesitas ayuda? Cont√°ctanos por cualquiera de estos medios:', 12);
    
    this.addTitle('üì± WhatsApp Oficial:', 2);
    this.addText('+53 54690878', 14, 'bold', [37, 211, 102]);
    this.addText('Disponible para consultas, pedidos y soporte t√©cnico', 11);
    
    this.addTitle('üè™ Ubicaci√≥n F√≠sica:', 2);
    this.addText('Santiago de Cuba, Cuba', 12, 'bold');
    this.addText('Coordenadas GPS: 20.039585, -75.849663', 11);
    
    this.addTitle('üåê Sitio Web:', 2);
    this.addText('https://yeroshop.vercel.app', 12, 'bold', [59, 130, 246]);
    
    this.addTitle('üìß Redes Sociales:', 2);
    this.addText('üê¶ Twitter: @yero_shop', 11);
    this.addText('üíº LinkedIn: Yero Shop', 11);
    this.addText('üìò Facebook: Yero Shop', 11);

    this.addSeparator();
    
    this.addTitle('üôè Agradecimientos:', 2);
    this.addText('Gracias por elegir Yero Shop! Tu confianza es nuestro mayor tesoro. Trabajamos cada d√≠a para superar tus expectativas y brindarte la mejor experiencia de compra online en Cuba.', 12);
    
    this.currentY += 10;
    this.addText('‚ú® "La plataforma de comercio detr√°s de todo" ‚ú®', 14, 'bold', [59, 130, 246]);
  }

  /**
   * Agrega numeraci√≥n de p√°ginas
   */
  addPageNumbers() {
    const totalPages = this.pdf.internal.getNumberOfPages();
    
    for (let i = 1; i <= totalPages; i++) {
      this.pdf.setPage(i);
      this.pdf.setFontSize(10);
      this.pdf.setTextColor(150, 150, 150);
      this.pdf.text(
        `P√°gina ${i} de ${totalPages}`,
        this.pageWidth / 2,
        this.pageHeight - 10,
        { align: 'center' }
      );
      
      // Agregar marca de agua en cada p√°gina
      this.pdf.setTextColor(240, 240, 240);
      this.pdf.setFontSize(40);
      this.pdf.text(
        'Yero Shop!',
        this.pageWidth / 2,
        this.pageHeight / 2,
        { align: 'center', angle: 45 }
      );
    }
  }

  /**
   * Genera el PDF completo
   */
  async generateCompletePDF() {
    try {
      toastHandler(ToastType.Info, 'üìÑ Generando gu√≠a PDF completa...');
      
      this.initializePDF();
      
      // Agregar todas las secciones
      this.addCover();
      this.addIntroduction();
      this.addNavigationSection();
      this.addProductsSection();
      this.addSearchSection();
      this.addCartSection();
      this.addWishlistSection();
      this.addAuthSection();
      this.addAddressSection();
      this.addCheckoutSection();
      this.addCurrencySection();
      this.addAdminSection();
      this.addTipsSection();
      this.addFAQSection();
      this.addContactSection();
      
      // Agregar numeraci√≥n de p√°ginas
      this.addPageNumbers();
      
      // Generar nombre del archivo
      const timestamp = new Date().toISOString().split('T')[0];
      const fileName = `Yero-Shop-Guia-Completa-${timestamp}.pdf`;
      
      // Descargar el PDF
      this.pdf.save(fileName);
      
      toastHandler(ToastType.Success, 'üéâ ¬°Gu√≠a PDF descargada exitosamente!');
      toastHandler(ToastType.Info, `üìÅ Archivo: ${fileName}`);
      
      return true;
      
    } catch (error) {
      console.error('Error generando PDF:', error);
      toastHandler(ToastType.Error, 'Error al generar la gu√≠a PDF');
      return false;
    }
  }
}

/**
 * Funci√≥n principal para generar y descargar la gu√≠a
 */
export const generateStoreGuide = async () => {
  const generator = new PDFGuideGenerator();
  return await generator.generateCompletePDF();
};

/**
 * Funci√≥n para generar gu√≠a con capturas de pantalla en tiempo real
 */
export const generateInteractiveGuide = async () => {
  try {
    toastHandler(ToastType.Info, 'üì∏ Generando gu√≠a interactiva con capturas...');
    
    const generator = new PDFGuideGenerator();
    generator.initializePDF();
    
    // Portada
    generator.addCover();
    
    // Capturar elementos actuales de la p√°gina
    const captures = [];
    
    // Intentar capturar navbar si existe
    const navbarCapture = await generator.captureElement('nav', 'üß≠ Barra de Navegaci√≥n Principal');
    if (navbarCapture) captures.push(navbarCapture);
    
    // Intentar capturar hero si existe
    const heroCapture = await generator.captureElement('.hero', 'üéØ Secci√≥n Principal de Bienvenida');
    if (heroCapture) captures.push(heroCapture);
    
    // Agregar capturas al PDF
    if (captures.length > 0) {
      generator.pdf.addPage();
      generator.currentY = generator.margin;
      generator.addTitle('üì∏ Capturas de Pantalla en Tiempo Real');
      
      captures.forEach(capture => {
        generator.addImage(capture.canvas, capture.description);
      });
    }
    
    // Agregar resto del contenido
    generator.addIntroduction();
    generator.addNavigationSection();
    generator.addProductsSection();
    generator.addSearchSection();
    generator.addCartSection();
    generator.addWishlistSection();
    generator.addAuthSection();
    generator.addAddressSection();
    generator.addCheckoutSection();
    generator.addCurrencySection();
    generator.addAdminSection();
    generator.addTipsSection();
    generator.addFAQSection();
    generator.addContactSection();
    
    // Finalizar
    generator.addPageNumbers();
    
    const timestamp = new Date().toISOString().split('T')[0];
    const fileName = `Yero-Shop-Guia-Interactiva-${timestamp}.pdf`;
    
    generator.pdf.save(fileName);
    
    toastHandler(ToastType.Success, 'üéâ ¬°Gu√≠a interactiva descargada exitosamente!');
    toastHandler(ToastType.Info, `üìÅ Archivo: ${fileName}`);
    
    return true;
    
  } catch (error) {
    console.error('Error generando gu√≠a interactiva:', error);
    toastHandler(ToastType.Error, 'Error al generar la gu√≠a interactiva');
    return false;
  }
};